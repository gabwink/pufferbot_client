project(Dependencies)
set(DEPENDENCY_TARGETS_FOLDER "${CMAKE_CURRENT_BINARY_DIR}")
add_subdirectory(${DEPENDENCY})
get_property(DEPENDENCY_TARGETS DIRECTORY ${DEPENDENCY} PROPERTY BUILDSYSTEM_TARGETS)
get_property(DEPENDENCY_INCLUDE_DIRECTORIES DIRECTORY ${DEPENDENCY} PROPERTY INCLUDE_DIRECTORIES)
set(DEPENDENCY_LIBRARY_TARGETS "")
if (EXISTS "${CMAKE_CURRENT_BINARY_DIR}/dependency-imported_targets.txt")
    file(READ "${CMAKE_CURRENT_BINARY_DIR}/dependency-imported_targets.txt" DEPENDENCY_LIBRARY_TARGETS)
endif()
foreach(DEPENDENCY_TARGET ${DEPENDENCY_TARGETS})
    get_target_property(DEPENDENCY_TARGET_TYPE ${DEPENDENCY_TARGET} TYPE)
    if (NOT "${DEPENDENCY_TARGET_TYPE}" MATCHES "LIBRARY")
        continue()
    endif()
    if ("${DEPENDENCY_TARGET_TYPE}" MATCHES "INTERFACE_LIBRARY")
        continue()
    endif()
    list(APPEND DEPENDENCY_LIBRARY_TARGETS ${DEPENDENCY_TARGET})
    get_target_property(DEPENDENCY_TARGET_PATH ${DEPENDENCY_TARGET} BINARY_DIR)
    get_target_property(DEPENDENCY_TARGET_INCLUDE_DIRECTORIES ${DEPENDENCY_TARGET} INCLUDE_DIRECTORIES)
    get_target_property(DEPENDENCY_TARGET_LINK_LIBRARIES ${DEPENDENCY_TARGET} LINK_LIBRARIES)
    file(WRITE "${CMAKE_CURRENT_BINARY_DIR}/dependency_${DEPENDENCY_TARGET}-path.txt" "${DEPENDENCY_TARGET_PATH}")
    file(WRITE "${CMAKE_CURRENT_BINARY_DIR}/dependency_${DEPENDENCY_TARGET}-include_directories.txt" "${DEPENDENCY_TARGET_INCLUDE_DIRECTORIES}")
    if (NOT "${DEPENDENCY_TARGET_LINK_LIBRARIES}" MATCHES "NOTFOUND")
        file(WRITE "${CMAKE_CURRENT_BINARY_DIR}/dependency_${DEPENDENCY_TARGET}-link_libraries.txt" "${DEPENDENCY_TARGET_LINK_LIBRARIES}")
    endif()
    file(GENERATE OUTPUT "${CMAKE_CURRENT_BINARY_DIR}/dependency_${DEPENDENCY_TARGET}-bin.txt" CONTENT "$<TARGET_FILE:${DEPENDENCY_TARGET}>")
endforeach()
file(WRITE "${CMAKE_CURRENT_BINARY_DIR}/dependency-targets.txt" "${DEPENDENCY_LIBRARY_TARGETS}")
file(WRITE "${CMAKE_CURRENT_BINARY_DIR}/dependency-include_directories.txt" "${DEPENDENCY_INCLUDE_DIRECTORIES}")